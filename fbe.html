<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pflegeplanung Simulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --primary-light: #eef2ff;
            --secondary: #7209b7;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #fca311;
            --danger: #e63946;
            --coin: #ffd166;
            --xp: #06d6a0;
            --level: #118ab2;
            --text-primary: #1d3557;
            --text-secondary: #457b9d;
            --text-tertiary: #a8dadc;
            --background: #f1faee;
            --surface: #ffffff;
            --border: #e0e0e0;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-elevated: 0 8px 24px rgba(0, 0, 0, 0.12);
            --radius: 12px;
            --radius-lg: 20px;
            --spacing-xs: 8px;
            --spacing-sm: 16px;
            --spacing-md: 24px;
            --spacing-lg: 32px;
            --spacing-xl: 48px;
            --spacing-xxl: 64px;
            --font-primary: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            color: var(--text-primary);
            background-color: var(--background);
            line-height: 1.6;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }

        /* ===== NAVIGATION BAR ===== */
        .navbar {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 0;
            box-shadow: var(--shadow-elevated);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 800;
            font-size: 1.5rem;
            color: white;
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: var(--spacing-md);
            align-items: center;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            font-weight: 600;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .nav-link i {
            font-size: 1.1rem;
        }

        .nav-cta {
            background: var(--accent);
            color: white;
            padding: var(--spacing-xs) var(--spacing-lg);
            border-radius: var(--radius-lg);
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(247, 37, 133, 0.4);
        }

        .nav-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(247, 37, 133, 0.5);
        }

        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
            background: none;
            border: none;
            padding: var(--spacing-xs);
            z-index: 1001;
        }

        .hamburger span {
            width: 25px;
            height: 3px;
            background: white;
            margin: 3px 0;
            transition: 0.3s;
            border-radius: 2px;
        }

        /* Active hamburger animation */
        .hamburger.active span:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }

        /* ===== ECONOMY BAR ===== */
        .economy-bar {
            background: rgba(255, 255, 255, 0.1);
            padding: var(--spacing-xs) 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .economy-stats {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-lg);
            align-items: center;
        }

        .economy-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-weight: 700;
            font-size: 0.95rem;
            padding: 6px 12px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .economy-item.coins {
            background: linear-gradient(135deg, var(--coin) 0%, #ffb347 100%);
            color: var(--text-primary);
            animation: glow 2s infinite alternate;
        }

        .economy-item.xp {
            background: linear-gradient(135deg, var(--xp) 0%, #04a57d 100%);
            color: white;
            animation: glow 2s infinite alternate 0.3s;
        }

        .economy-item.level {
            background: linear-gradient(135deg, var(--level) 0%, #0c6c8c 100%);
            color: white;
            animation: glow 2s infinite alternate 0.6s;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
            to { box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        }

        .economy-item i {
            font-size: 1.1rem;
        }

        /* Mobile economy stats */
        .mobile-economy {
            display: none;
            justify-content: space-around;
            padding: var(--spacing-sm) 0;
            background: rgba(255, 255, 255, 0.1);
        }

        /* Main Content */
        main {
            padding: var(--spacing-xl) 0;
            flex-grow: 1;
        }

        .section-title {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            font-size: 2rem;
            color: var(--text-primary);
        }

        .section-subtitle {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            color: var(--text-secondary);
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Simulator Container */
        .simulator-container {
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: var(--spacing-xl);
        }

        /* Case Study */
        .case-study {
            padding: var(--spacing-lg);
            background: #f0f7f0;
            border-bottom: 1px solid var(--border);
        }

        .case-title {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-sm);
            color: var(--primary);
        }

        .case-description {
            line-height: 1.8;
            margin-bottom: var(--spacing-md);
        }

        .case-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
            background: white;
            padding: var(--spacing-md);
            border-radius: var(--radius);
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: var(--spacing-xs);
        }

        .info-value {
            font-weight: 500;
        }

        /* Steps Navigation */
        .simulator-steps {
            display: flex;
            justify-content: space-between;
            margin: var(--spacing-lg);
            position: relative;
        }

        .simulator-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border);
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
            max-width: 150px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
            transition: all 0.3s;
        }

        .step.active .step-number {
            background: var(--primary);
            color: white;
        }

        .step.completed .step-number {
            background: var(--success);
            color: white;
        }

        .step-label {
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
        }

        /* Step Content */
        .step-content {
            display: none;
            padding: 0 var(--spacing-lg) var(--spacing-lg);
        }

        .step-content.active {
            display: block;
        }

        .step-title {
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 1px solid var(--border);
        }

        .step-description {
            margin-bottom: var(--spacing-lg);
            color: var(--text-secondary);
        }

        /* Data Categorization */
        .categorization-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        @media (max-width: 768px) {
            .categorization-area {
                grid-template-columns: 1fr;
            }
        }

        .data-items {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .data-item {
            background: var(--primary-light);
            padding: var(--spacing-md);
            border-radius: var(--radius);
            border: 2px dashed var(--primary);
            cursor: grab;
            transition: all 0.3s;
            user-select: none;
            touch-action: none;
        }

        .data-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .categories {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
        }

        .category {
            background: white;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: var(--spacing-md);
            min-height: 120px;
            transition: all 0.3s;
        }

        .category.hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .category-title {
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .category-items {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
            min-height: 60px;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .option-card {
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: var(--spacing-md);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
        }

        .option-card:hover {
            border-color: var(--primary-light);
            background: #f8f9fa;
        }

        .option-card.selected {
            border-color: var(--primary);
            background: #e8f4e8;
        }

        .option-card.correct {
            border-color: var(--success);
            background: #d4edda;
        }

        .option-card.incorrect {
            border-color: var(--danger);
            background: #f8d7da;
        }

        .option-indicator {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .option-card.selected .option-indicator {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .option-card.correct .option-indicator {
            border-color: var(--success);
            background: var(--success);
            color: white;
        }

        .option-card.incorrect .option-indicator {
            border-color: var(--danger);
            background: var(--danger);
            color: white;
        }

        .option-text {
            flex-grow: 1;
        }

        .option-label {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            color: var(--primary);
        }

        .option-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Navigation Buttons */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-lg);
        }

        .btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--light-surface);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .btn-secondary:hover {
            background: #f0f0f0;
        }

        .btn:disabled {
            background: var(--border);
            color: var(--text-secondary);
            cursor: not-allowed;
            border: none;
        }

        /* Results Screen */
        .results-screen {
            text-align: center;
            padding: var(--spacing-xl);
            display: none;
        }

        .results-screen.active {
            display: block;
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-md);
            color: var(--success);
        }

        .result-title {
            font-size: 2rem;
            margin-bottom: var(--spacing-md);
            color: var(--primary);
        }

        .result-score {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            color: var(--success);
        }

        .result-feedback {
            font-size: 1.2rem;
            margin-bottom: var(--spacing-xl);
            color: var(--text-secondary);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .result-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }

        .breakdown-item {
            background: white;
            padding: var(--spacing-md);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .breakdown-label {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            color: var(--text-secondary);
        }

        .breakdown-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .result-actions {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-xl);
        }

        /* Footer */
        footer {
            background: var(--text-primary);
            color: white;
            padding: var(--spacing-lg) 0;
            margin-top: auto;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .footer-logo {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .footer-links {
            display: flex;
            gap: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .footer-link {
            color: #ddd;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-link:hover {
            color: white;
        }

        .footer-bottom {
            text-align: center;
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #aaa;
            font-size: 0.9rem;
            width: 100%;
        }

        /* Auto-scroll indicator for mobile */
        .scroll-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            z-index: 999;
            display: none;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hamburger {
                display: flex;
            }
            
            .nav-menu {
                position: fixed;
                left: -100%;
                top: 0;
                flex-direction: column;
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                width: 80%;
                height: 100vh;
                text-align: left;
                transition: 0.3s;
                box-shadow: var(--shadow-elevated);
                padding: var(--spacing-xxl) var(--spacing-lg);
                gap: 0;
                z-index: 999;
                overflow-y: auto;
            }
            
            .nav-menu.active {
                left: 0;
            }
            
            .nav-item {
                margin: var(--spacing-sm) 0;
                width: 100%;
            }
            
            .nav-link {
                justify-content: flex-start;
                padding: var(--spacing-md);
                font-size: 1.1rem;
            }
            
            .economy-bar {
                display: none;
            }
            
            .mobile-economy {
                display: flex;
            }
            
            .simulator-steps {
                flex-wrap: wrap;
                gap: var(--spacing-md);
            }
            
            .simulator-steps::before {
                display: none;
            }
            
            .step {
                flex: 1;
                min-width: 120px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: var(--spacing-md);
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .result-actions {
                flex-direction: column;
            }
            
            .footer-content {
                flex-direction: column;
                text-align: center;
            }
            
            .footer-links {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="container nav-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-stethoscope"></i>
                </div>
                <span>Pflegeplanung Simulator</span>
            </a>
            
            <button class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <ul class="nav-menu" id="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active">
                        <i class="fas fa-home"></i>
                        Startseite
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-book-medical"></i>
                        Lernmodule
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-gamepad"></i>
                        Lernspiele
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-procedures"></i>
                        Fallbeispiele
                    </a>
                </li>
            </ul>
        </div>

        <!-- Economy Bar -->
        <div class="economy-bar">
            <div class="container">
                <div class="economy-stats">
                    <div class="economy-item coins">
                        <i class="fas fa-coins"></i>
                        <span id="coins">150</span>
                    </div>
                    <div class="economy-item xp">
                        <i class="fas fa-fire"></i>
                        <span id="xp">75</span> XP
                    </div>
                    <div class="economy-item level">
                        <i class="fas fa-level-up-alt"></i>
                        Level <span id="level">2</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Economy Stats (shown only on mobile) -->
        <div class="mobile-economy">
            <div class="economy-item coins">
                <i class="fas fa-coins"></i>
                <span id="mobile-coins">150</span>
            </div>
            <div class="economy-item xp">
                <i class="fas fa-fire"></i>
                <span id="mobile-xp">75</span>
            </div>
            <div class="economy-item level">
                <i class="fas fa-level-up-alt"></i>
                <span id="mobile-level">2</span>
            </div>
        </div>
    </nav>

    <!-- Auto-scroll indicator -->
    <div class="scroll-indicator" id="scroll-indicator">
        <i class="fas fa-arrow-down"></i>
        Scrollen zum Ablegen
    </div>

    <!-- Main Content -->
    <main>
        <div class="container">
            <h1 class="section-title">Pflegeplanung Simulator</h1>
            <p class="section-subtitle">
                Üben Sie die Pflegeplanung mit realistischen Fallbeispielen. Kategorisieren Sie Informationen, identifizieren Sie Probleme, setzen Sie Ziele und planen Sie Maßnahmen.
            </p>

            <!-- Simulator Container -->
            <div class="simulator-container">
                <!-- Case Study -->
                <div class="case-study">
                    <h2 class="case-title" id="case-title">Fallbeispiel: Frau Schmidt</h2>
                    <div class="case-description" id="case-description">
                        Frau Schmidt, 82 Jahre, ist nach einem Sturz mit Oberschenkelhalsfraktur operiert worden (Dynamische Hüftschraube). 
                        Sie ist seit 3 Tagen postoperativ, hat starke Schmerzen (8/10 auf der Schmerzskala) und ist in ihrer Mobilität eingeschränkt. 
                        Sie benötigt Hilfe bei der Körperpflege und beim Anziehen. Sie ist ängstlich vor erneuten Stürzen und wirkt desorientiert. 
                        Ihre Haut zeigt eine beginnende Rötung am Kreuzbein. Sie hat Appetitmangel und trinkt wenig. Frau Schmidt war früher Lehrerin, 
                        ist verwitwet und lebt allein. Ihre Tochter besucht sie täglich im Krankenhaus.
                    </div>
                    <div class="case-info">
                        <div class="info-item">
                            <div class="info-label">Patient</div>
                            <div class="info-value">Frau Schmidt, 82 Jahre</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Diagnose</div>
                            <div class="info-value">Oberschenkelhalsfraktur, Status post OP</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Situation</div>
                            <div class="info-value">Stationäre Pflege, 3. postoperativer Tag</div>
                        </div>
                    </div>
                </div>

                <!-- Steps Navigation -->
                <div class="simulator-steps">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">Daten kategorisieren</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">Probleme identifizieren</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-label">Ziele setzen</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-label">Maßnahmen planen</div>
                    </div>
                    <div class="step" data-step="5">
                        <div class="step-number">5</div>
                        <div class="step-label">Evaluation</div>
                    </div>
                </div>

                <!-- Step 1: Data Categorization -->
                <div class="step-content active" data-step="1">
                    <h3 class="step-title">Daten kategorisieren</h3>
                    <p class="step-description">
                        Ziehen Sie die Informationen aus dem Fallbeispiel in die richtigen Kategorien:
                    </p>
                    
                    <div class="categorization-area">
                        <div class="data-items" id="data-items">
                            <!-- Data items will be populated by JavaScript -->
                        </div>
                        <div class="categories">
                            <div class="category" data-category="biographisch">
                                <div class="category-title">
                                    <i class="fas fa-user"></i>
                                    Biographisch
                                </div>
                                <div class="category-items" id="biographisch-items"></div>
                            </div>
                            <div class="category" data-category="sozial">
                                <div class="category-title">
                                    <i class="fas fa-users"></i>
                                    Sozial
                                </div>
                                <div class="category-items" id="sozial-items"></div>
                            </div>
                            <div class="category" data-category="medizinisch">
                                <div class="category-title">
                                    <i class="fas fa-heartbeat"></i>
                                    Medizinisch
                                </div>
                                <div class="category-items" id="medizinisch-items"></div>
                            </div>
                            <div class="category" data-category="pflegerisch">
                                <div class="category-title">
                                    <i class="fas fa-hand-holding-heart"></i>
                                    Pflegerisch
                                </div>
                                <div class="category-items" id="pflegerisch-items"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="navigation-buttons">
                        <button class="btn btn-secondary" id="back-to-cases">
                            <i class="fas fa-arrow-left"></i>
                            Zurück zu Fallbeispielen
                        </button>
                        <button class="btn btn-primary" id="next-to-probleme" disabled>
                            Weiter zu Problemen
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Problem Identification -->
                <div class="step-content" data-step="2">
                    <h3 class="step-title">Probleme identifizieren</h3>
                    <p class="step-description">
                        Identifizieren Sie 2 korrekte Pflegeprobleme für dieses Fallbeispiel. Wählen Sie aus den folgenden Optionen:
                    </p>
                    
                    <div class="options-grid" id="problem-options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                    
                    <div class="navigation-buttons">
                        <button class="btn btn-secondary" id="back-to-categorization">
                            <i class="fas fa-arrow-left"></i>
                            Zurück zur Kategorisierung
                        </button>
                        <button class="btn btn-primary" id="next-to-ziele" disabled>
                            Weiter zu Zielen
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Goal Setting -->
                <div class="step-content" data-step="3">
                    <h3 class="step-title">Pflegeziele setzen</h3>
                    <p class="step-description">
                        Setzen Sie für jedes identifizierte Problem 2 korrekte Ziele. Wählen Sie aus den folgenden Optionen:
                    </p>
                    
                    <div id="ziele-container">
                        <!-- Dynamic content will be added by JavaScript -->
                    </div>
                    
                    <div class="navigation-buttons">
                        <button class="btn btn-secondary" id="back-to-probleme">
                            <i class="fas fa-arrow-left"></i>
                            Zurück zu Problemen
                        </button>
                        <button class="btn btn-primary" id="next-to-massnahmen" disabled>
                            Weiter zu Maßnahmen
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 4: Intervention Planning -->
                <div class="step-content" data-step="4">
                    <h3 class="step-title">Pflegemaßnahmen planen</h3>
                    <p class="step-description">
                        Planen Sie für jedes Problem 5 korrekte Maßnahmen. Wählen Sie aus den folgenden Optionen:
                    </p>
                    
                    <div id="massnahmen-container">
                        <!-- Dynamic content will be added by JavaScript -->
                    </div>
                    
                    <div class="navigation-buttons">
                        <button class="btn btn-secondary" id="back-to-ziele">
                            <i class="fas fa-arrow-left"></i>
                            Zurück zu Zielen
                        </button>
                        <button class="btn btn-primary" id="next-to-evaluation">
                            Auswerten
                            <i class="fas fa-check-circle"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 5: Evaluation -->
                <div class="step-content" data-step="5">
                    <h3 class="step-title">Evaluation</h3>
                    <p class="step-description">
                        Ihre Auswahl wird jetzt ausgewertet.
                    </p>
                    
                    <div class="navigation-buttons">
                        <button class="btn btn-secondary" id="back-to-massnahmen">
                            <i class="fas fa-arrow-left"></i>
                            Zurück zu Maßnahmen
                        </button>
                        <button class="btn btn-primary" id="evaluate-answers">
                            Ergebnisse anzeigen
                            <i class="fas fa-chart-bar"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Results Screen -->
            <div class="results-screen" id="results-screen">
                <div class="result-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <h2 class="result-title">Herzlichen Glückwunsch!</h2>
                <div class="result-score" id="result-score">0%</div>
                <p class="result-feedback" id="result-feedback">
                    Sie haben das Fallbeispiel erfolgreich bearbeitet.
                </p>
                
                <div class="result-breakdown">
                    <div class="breakdown-item">
                        <div class="breakdown-label">Daten kategorisiert</div>
                        <div class="breakdown-value" id="categorization-score">0/8</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">Probleme</div>
                        <div class="breakdown-value" id="problem-score">0/2</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">Ziele Problem 1</div>
                        <div class="breakdown-value" id="ziel1-score">0/2</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">Ziele Problem 2</div>
                        <div class="breakdown-value" id="ziel2-score">0/2</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">Maßnahmen Problem 1</div>
                        <div class="breakdown-value" id="massnahme1-score">0/5</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">Maßnahmen Problem 2</div>
                        <div class="breakdown-value" id="massnahme2-score">0/5</div>
                    </div>
                </div>
                
                <div class="result-actions">
                    <button class="btn btn-secondary" id="review-answers">
                        <i class="fas fa-redo"></i>
                        Antworten überprüfen
                    </button>
                    <button class="btn btn-primary" id="next-case">
                        Nächstes Fallbeispiel
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">Pflegeplanung Simulator</div>
                <div class="footer-links">
                    <a href="#" class="footer-link">Startseite</a>
                    <a href="#" class="footer-link">Über dieses Projekt</a>
                    <a href="#" class="footer-link">Kontakt</a>
                </div>
                <div class="footer-bottom">
                    &copy; 2023 Pflegeplanung Simulator. Entwickelt für die Ausbildung.
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Case Study Data
        const caseStudies = [
            {
                id: 1,
                title: "Fallbeispiel: Frau Schmidt",
                description: "Frau Schmidt, 82 Jahre, ist nach einem Sturz mit Oberschenkelhalsfraktur operiert worden (Dynamische Hüftschraube). Sie ist seit 3 Tagen postoperativ, hat starke Schmerzen (8/10 auf der Schmerzskala) und ist in ihrer Mobilität eingeschränkt. Sie benötigt Hilfe bei der Körperpflege und beim Anziehen. Sie ist ängstlich vor erneuten Stürzen und wirkt desorientiert. Ihre Haut zeigt eine beginnende Rötung am Kreuzbein. Sie hat Appetitmangel und trinkt wenig. Frau Schmidt war früher Lehrerin, ist verwitwet und lebt allein. Ihre Tochter besucht sie täglich im Krankenhaus.",
                patient: "Frau Schmidt, 82 Jahre",
                diagnosis: "Oberschenkelhalsfraktur, Status post OP",
                situation: "Stationäre Pflege, 3. postoperativer Tag",
                dataItems: [
                    { id: "data-1", text: "82 Jahre alt", correctCategory: "biographisch" },
                    { id: "data-2", text: "War früher Lehrerin", correctCategory: "biographisch" },
                    { id: "data-3", text: "Verwitwet", correctCategory: "sozial" },
                    { id: "data-4", text: "Tochter besucht täglich", correctCategory: "sozial" },
                    { id: "data-5", text: "Oberschenkelhalsfraktur", correctCategory: "medizinisch" },
                    { id: "data-6", text: "Status post Operation", correctCategory: "medizinisch" },
                    { id: "data-7", text: "Benötigt Hilfe bei Körperpflege", correctCategory: "pflegerisch" },
                    { id: "data-8", text: "Hautrötung am Kreuzbein", correctCategory: "pflegerisch" }
                ],
                problems: {
                    question: "Identifizieren Sie 2 korrekte Pflegeprobleme:",
                    options: [
                        {
                            id: "problem-1",
                            text: "Akute Schmerzen",
                            description: "Durch postoperative Zustand und Bewegungseinschränkung",
                            correct: true,
                            type: "correct"
                        },
                        {
                            id: "problem-2",
                            text: "Risiko für Dekubitus",
                            description: "Durch Immobilität und Druck auf Gewebe",
                            correct: true,
                            type: "correct"
                        },
                        {
                            id: "problem-3",
                            text: "Eingeschränkte Mobilität",
                            description: "Durch schlechte Laune und Unlust sich zu bewegen",
                            correct: false,
                            type: "wrong-etiology"
                        },
                        {
                            id: "problem-4",
                            text: "Oberschenkelhalsfraktur",
                            description: "Diagnose nach Sturz",
                            correct: false,
                            type: "medical"
                        },
                        {
                            id: "problem-5",
                            text: "Zeitaufwändige Pflege",
                            description: "Benötigt viel Betreuung durch das Pflegepersonal",
                            correct: false,
                            type: "burden"
                        }
                    ]
                },
                ziele: {
                    // For each problem, we have goal options
                    "problem-1": {
                        title: "Ziele für 'Akute Schmerzen'",
                        options: [
                            {
                                id: "ziel-1-1",
                                text: "Die Schmerzintensität ist innerhalb von 30 Minuten von 8/10 auf 4/10 reduziert worden.",
                                correct: true
                            },
                            {
                                id: "ziel-1-2",
                                text: "Der Patient ist in 3 Tagen schmerzfrei.",
                                correct: false
                            },
                            {
                                id: "ziel-1-3",
                                text: "Die Schmerzintensität ist bei Mobilisation unter 3/10.",
                                correct: true
                            },
                            {
                                id: "ziel-1-4",
                                text: "Der Patient nimmt regelmäßig Schmerzmittel.",
                                correct: false
                            }
                        ]
                    },
                    "problem-2": {
                        title: "Ziele für 'Risiko für Dekubitus'",
                        options: [
                            {
                                id: "ziel-2-1",
                                text: "Die Haut am Kreuzbein ist in 24 Stunden ohne Rötung.",
                                correct: true
                            },
                            {
                                id: "ziel-2-2",
                                text: "Es ist während des Aufenthalts kein Dekubitus entstanden.",
                                correct: true
                            },
                            {
                                id: "ziel-2-3",
                                text: "Der Patient liegt bequem im Bett.",
                                correct: false
                            },
                            {
                                id: "ziel-2-4",
                                text: "Die Haut ist täglich eingecremt worden.",
                                correct: false
                            }
                        ]
                    }
                },
                massnahmen: {
                    // For each problem, we have measure options
                    "problem-1": {
                        title: "Maßnahmen für 'Akute Schmerzen'",
                        options: [
                            {
                                id: "massnahme-1-1",
                                text: "Die Pflegekraft verabreicht bei Schmerzangabe >4/10 das verordnete Analgetikum.",
                                correct: true
                            },
                            {
                                id: "massnahme-1-2",
                                text: "Die Pflegekraft lagert den Patienten schmerzentlastend mit Kissen.",
                                correct: true
                            },
                            {
                                id: "massnahme-1-3",
                                text: "Die Pflegekraft lenkt den Patienten durch Gespräche von den Schmerzen ab.",
                                correct: true
                            },
                            {
                                id: "massnahme-1-4",
                                text: "Die Pflegekraft dokumentiert die Schmerzintensität vor und nach Maßnahmen.",
                                correct: true
                            },
                            {
                                id: "massnahme-1-5",
                                text: "Die Pflegekraft appliziert Wärme/Kälte je nach Indikation.",
                                correct: true
                            },
                            {
                                id: "massnahme-1-6",
                                text: "Die Pflegekraft informiert den Arzt nur bei starken Schmerzen.",
                                correct: false
                            },
                            {
                                id: "massnahme-1-7",
                                text: "Die Pflegekraft lässt den Patienten alleine, um ihn nicht zu stören.",
                                correct: false
                            },
                            {
                                id: "massnahme-1-8",
                                text: "Die Pflegekraft verabreicht zusätzliche Schmerzmittel ohne Verordnung.",
                                correct: false
                            },
                            {
                                id: "massnahme-1-9",
                                text: "Die Pflegekraft massiert die schmerzende Stelle intensiv.",
                                correct: false
                            },
                            {
                                id: "massnahme-1-10",
                                text: "Die Pflegekraft erklärt dem Patienten, dass Schmerzen normal sind.",
                                correct: false
                            }
                        ]
                    },
                    "problem-2": {
                        title: "Maßnahmen für 'Risiko für Dekubitus'",
                        options: [
                            {
                                id: "massnahme-2-1",
                                text: "Die Pflegekraft lagert den Patienten nach Plan alle 2 Stunden um.",
                                correct: true
                            },
                            {
                                id: "massnahme-2-2",
                                text: "Die Pflegekraft inspiziert die Haut bei jeder Lagerung systematisch.",
                                correct: true
                            },
                            {
                                id: "massnahme-2-3",
                                text: "Die Pflegekraft verwendet eine Wechseldruckmatratze.",
                                correct: true
                            },
                            {
                                id: "massnahme-2-4",
                                text: "Die Pflegekraft hält die Haut trocken und sauber.",
                                correct: true
                            },
                            {
                                id: "massnahme-2-5",
                                text: "Die Pflegekraft fördert die Mobilisation soweit möglich.",
                                correct: true
                            },
                            {
                                id: "massnahme-2-6",
                                text: "Die Pflegekraft lässt den Patienten lange in einer Position liegen.",
                                correct: false
                            },
                            {
                                id: "massnahme-2-7",
                                text: "Die Pflegekraft verwendet normale Bettwäsche ohne Spezialauflagen.",
                                correct: false
                            },
                            {
                                id: "massnahme-2-8",
                                text: "Die Pflegekraft cremt die Haut nur bei sichtbaren Problemen ein.",
                                correct: false
                            },
                            {
                                id: "massnahme-2-9",
                                text: "Die Pflegekraft lagert den Patienten nach eigenem Ermessen.",
                                correct: false
                            },
                            {
                                id: "massnahme-2-10",
                                text: "Die Pflegekraft informiert den Patienten nicht über Dekubitusrisiko.",
                                correct: false
                            }
                        ]
                    }
                }
            }
        ];

        // Current State
        let currentCaseIndex = 0;
        let currentStep = 1;
        let userSelections = {
            categorization: {
                biographisch: [],
                sozial: [],
                medizinisch: [],
                pflegerisch: []
            },
            problems: [],
            ziele: {},
            massnahmen: {}
        };
        let selectedProblems = [];
        let isDragging = false;
        let scrollInterval;

        // DOM Elements
        const hamburger = document.getElementById('hamburger');
        const navMenu = document.getElementById('nav-menu');
        const caseTitleElement = document.getElementById('case-title');
        const caseDescriptionElement = document.getElementById('case-description');
        const stepElements = document.querySelectorAll('.step');
        const stepContentElements = document.querySelectorAll('.step-content');
        const resultsScreen = document.getElementById('results-screen');
        const resultScoreElement = document.getElementById('result-score');
        const resultFeedbackElement = document.getElementById('result-feedback');
        const categorizationScoreElement = document.getElementById('categorization-score');
        const problemScoreElement = document.getElementById('problem-score');
        const ziel1ScoreElement = document.getElementById('ziel1-score');
        const ziel2ScoreElement = document.getElementById('ziel2-score');
        const massnahme1ScoreElement = document.getElementById('massnahme1-score');
        const massnahme2ScoreElement = document.getElementById('massnahme2-score');
        const scrollIndicator = document.getElementById('scroll-indicator');

        // Initialize the simulator
        function initSimulator() {
            loadCaseStudy(currentCaseIndex);
            setupEventListeners();
            loadEconomy();
        }

        // Load a case study
        function loadCaseStudy(index) {
            const caseStudy = caseStudies[index];
            
            // Update case info
            caseTitleElement.textContent = caseStudy.title;
            caseDescriptionElement.textContent = caseStudy.description;
            
            // Update case info details
            document.querySelector('.info-item:nth-child(1) .info-value').textContent = caseStudy.patient;
            document.querySelector('.info-item:nth-child(2) .info-value').textContent = caseStudy.diagnosis;
            document.querySelector('.info-item:nth-child(3) .info-value').textContent = caseStudy.situation;
            
            // Load data items for categorization
            loadDataItems(caseStudy.dataItems);
            
            // Load problem options
            loadProblemOptions(caseStudy.problems);
            
            // Reset user selections
            userSelections = {
                categorization: {
                    biographisch: [],
                    sozial: [],
                    medizinisch: [],
                    pflegerisch: []
                },
                problems: [],
                ziele: {},
                massnahmen: {}
            };
            selectedProblems = [];
            
            // Reset UI
            resetStepNavigation();
            goToStep(1);
            resultsScreen.classList.remove('active');
            document.querySelector('.simulator-container').style.display = 'block';
        }

        // Load data items for categorization
        function loadDataItems(dataItems) {
            const container = document.getElementById('data-items');
            container.innerHTML = '';
            
            // Clear category items
            document.getElementById('biographisch-items').innerHTML = '';
            document.getElementById('sozial-items').innerHTML = '';
            document.getElementById('medizinisch-items').innerHTML = '';
            document.getElementById('pflegerisch-items').innerHTML = '';
            
            dataItems.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'data-item';
                itemElement.id = item.id;
                itemElement.textContent = item.text;
                itemElement.draggable = true;
                
                itemElement.addEventListener('dragstart', handleDragStart);
                itemElement.addEventListener('dragend', handleDragEnd);
                
                container.appendChild(itemElement);
            });
            
            // Set up drop zones
            setupDropZones();
        }

        // Set up drop zones for categorization
        function setupDropZones() {
            const categories = document.querySelectorAll('.category');
            
            categories.forEach(category => {
                category.addEventListener('dragover', handleDragOver);
                category.addEventListener('dragenter', handleDragEnter);
                category.addEventListener('dragleave', handleDragLeave);
                category.addEventListener('drop', handleDrop);
            });
        }

        // Drag and drop handlers
        function handleDragStart(e) {
            isDragging = true;
            e.dataTransfer.setData('text/plain', e.target.id);
            e.target.classList.add('dragging');
            
            // Start auto-scroll on mobile
            if (window.innerWidth <= 768) {
                startAutoScroll();
                scrollIndicator.style.display = 'flex';
            }
        }

        function handleDragEnd() {
            isDragging = false;
            
            // Stop auto-scroll
            stopAutoScroll();
            scrollIndicator.style.display = 'none';
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDragEnter(e) {
            e.preventDefault();
            e.target.closest('.category').classList.add('hover');
        }

        function handleDragLeave(e) {
            e.target.closest('.category').classList.remove('hover');
        }

        function handleDrop(e) {
            e.preventDefault();
            const category = e.target.closest('.category');
            category.classList.remove('hover');
            
            const id = e.dataTransfer.getData('text/plain');
            const draggable = document.getElementById(id);
            
            if (category && draggable) {
                const categoryType = category.dataset.category;
                const categoryItems = category.querySelector('.category-items');
                
                // Remove from previous category if it was categorized before
                const previousCategory = draggable.parentElement.closest('.category');
                if (previousCategory) {
                    const previousCategoryType = previousCategory.dataset.category;
                    userSelections.categorization[previousCategoryType] = 
                        userSelections.categorization[previousCategoryType].filter(itemId => itemId !== id);
                }
                
                // Add to new category
                categoryItems.appendChild(draggable);
                draggable.classList.remove('dragging');
                
                // Store selection
                if (!userSelections.categorization[categoryType].includes(id)) {
                    userSelections.categorization[categoryType].push(id);
                }
                
                // Check if all items are categorized to enable next button
                const totalItems = caseStudies[currentCaseIndex].dataItems.length;
                const categorizedItems = Object.values(userSelections.categorization).flat().length;
                document.getElementById('next-to-probleme').disabled = categorizedItems !== totalItems;
            }
            
            // Stop auto-scroll after drop
            stopAutoScroll();
            scrollIndicator.style.display = 'none';
        }

        // Auto-scroll functionality for mobile
        function startAutoScroll() {
            scrollInterval = setInterval(() => {
                if (isDragging) {
                    // Get the current scroll position
                    const scrollY = window.scrollY || window.pageYOffset;
                    const windowHeight = window.innerHeight;
                    const documentHeight = document.documentElement.scrollHeight;
                    
                    // Scroll down if we're near the bottom
                    if (scrollY + windowHeight < documentHeight - 100) {
                        window.scrollBy(0, 10);
                    }
                } else {
                    stopAutoScroll();
                }
            }, 50);
        }

        function stopAutoScroll() {
            clearInterval(scrollInterval);
        }

        // Load problem options
        function loadProblemOptions(problemsData) {
            const container = document.getElementById('problem-options');
            container.innerHTML = '';
            
            problemsData.options.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option-card';
                optionElement.dataset.id = option.id;
                optionElement.dataset.type = option.type;
                
                optionElement.innerHTML = `
                    <div class="option-indicator">${String.fromCharCode(65 + problemsData.options.indexOf(option))}</div>
                    <div class="option-text">
                        <div class="option-label">${option.text}</div>
                        <div class="option-description">${option.description}</div>
                    </div>
                `;
                
                optionElement.addEventListener('click', () => selectProblemOption(option.id));
                container.appendChild(optionElement);
            });
        }

        // Load ziele options for selected problems
        function loadZieleOptions() {
            const container = document.getElementById('ziele-container');
            container.innerHTML = '';
            
            const caseStudy = caseStudies[currentCaseIndex];
            
            selectedProblems.forEach(problemId => {
                const problem = caseStudy.problems.options.find(p => p.id === problemId);
                const zieleData = caseStudy.ziele[problemId];
                
                const section = document.createElement('div');
                section.className = 'ziele-section';
                section.innerHTML = `
                    <h4>${zieleData.title}</h4>
                    <div class="options-grid" id="ziele-${problemId}">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                `;
                
                container.appendChild(section);
                
                // Load options for this problem
                const optionsContainer = document.getElementById(`ziele-${problemId}`);
                zieleData.options.forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option-card';
                    optionElement.dataset.id = option.id;
                    optionElement.dataset.problem = problemId;
                    
                    optionElement.innerHTML = `
                        <div class="option-indicator">${String.fromCharCode(65 + zieleData.options.indexOf(option))}</div>
                        <div class="option-text">
                            <div class="option-description">${option.text}</div>
                        </div>
                    `;
                    
                    optionElement.addEventListener('click', () => selectZielOption(option.id, problemId));
                    optionsContainer.appendChild(optionElement);
                });
            });
        }

        // Load massnahmen options for selected problems
        function loadMassnahmenOptions() {
            const container = document.getElementById('massnahmen-container');
            container.innerHTML = '';
            
            const caseStudy = caseStudies[currentCaseIndex];
            
            selectedProblems.forEach(problemId => {
                const problem = caseStudy.problems.options.find(p => p.id === problemId);
                const massnahmenData = caseStudy.massnahmen[problemId];
                
                const section = document.createElement('div');
                section.className = 'massnahmen-section';
                section.innerHTML = `
                    <h4>${massnahmenData.title}</h4>
                    <div class="options-grid" id="massnahmen-${problemId}">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                `;
                
                container.appendChild(section);
                
                // Load options for this problem
                const optionsContainer = document.getElementById(`massnahmen-${problemId}`);
                massnahmenData.options.forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option-card';
                    optionElement.dataset.id = option.id;
                    optionElement.dataset.problem = problemId;
                    
                    optionElement.innerHTML = `
                        <div class="option-indicator">${String.fromCharCode(65 + massnahmenData.options.indexOf(option))}</div>
                        <div class="option-text">
                            <div class="option-description">${option.text}</div>
                        </div>
                    `;
                    
                    optionElement.addEventListener('click', () => selectMassnahmeOption(option.id, problemId));
                    optionsContainer.appendChild(optionElement);
                });
            });
        }

        // Select problem option
        function selectProblemOption(optionId) {
            const selectedCard = document.querySelector(`#problem-options .option-card[data-id="${optionId}"]`);
            const caseStudy = caseStudies[currentCaseIndex];
            const option = caseStudy.problems.options.find(o => o.id === optionId);
            
            // Toggle selection
            if (selectedCard.classList.contains('selected')) {
                selectedCard.classList.remove('selected');
                // Remove from selections
                userSelections.problems = userSelections.problems.filter(id => id !== optionId);
                selectedProblems = selectedProblems.filter(id => id !== optionId);
            } else {
                // Check if we can select more (max 2)
                if (userSelections.problems.length < 2) {
                    selectedCard.classList.add('selected');
                    // Add to selections
                    userSelections.problems.push(optionId);
                    selectedProblems.push(optionId);
                } else {
                    alert('Sie können maximal 2 Probleme auswählen.');
                    return;
                }
            }
            
            // Enable next button if exactly 2 problems are selected
            document.getElementById('next-to-ziele').disabled = userSelections.problems.length !== 2;
        }

        // Select ziel option
        function selectZielOption(optionId, problemId) {
            const selectedCard = document.querySelector(`#ziele-${problemId} .option-card[data-id="${optionId}"]`);
            
            // Initialize array for this problem if it doesn't exist
            if (!userSelections.ziele[problemId]) {
                userSelections.ziele[problemId] = [];
            }
            
            // Toggle selection
            if (selectedCard.classList.contains('selected')) {
                selectedCard.classList.remove('selected');
                // Remove from selections
                userSelections.ziele[problemId] = userSelections.ziele[problemId].filter(id => id !== optionId);
            } else {
                // Check if we can select more (max 2 per problem)
                if (userSelections.ziele[problemId].length < 2) {
                    selectedCard.classList.add('selected');
                    // Add to selections
                    userSelections.ziele[problemId].push(optionId);
                } else {
                    alert('Sie können maximal 2 Ziele pro Problem auswählen.');
                    return;
                }
            }
            
            // Enable next button if all problems have 2 goals selected
            let allProblemsHaveGoals = true;
            selectedProblems.forEach(problemId => {
                if (!userSelections.ziele[problemId] || userSelections.ziele[problemId].length !== 2) {
                    allProblemsHaveGoals = false;
                }
            });
            
            document.getElementById('next-to-massnahmen').disabled = !allProblemsHaveGoals;
        }

        // Select massnahme option
        function selectMassnahmeOption(optionId, problemId) {
            const selectedCard = document.querySelector(`#massnahmen-${problemId} .option-card[data-id="${optionId}"]`);
            
            // Initialize array for this problem if it doesn't exist
            if (!userSelections.massnahmen[problemId]) {
                userSelections.massnahmen[problemId] = [];
            }
            
            // Toggle selection
            if (selectedCard.classList.contains('selected')) {
                selectedCard.classList.remove('selected');
                // Remove from selections
                userSelections.massnahmen[problemId] = userSelections.massnahmen[problemId].filter(id => id !== optionId);
            } else {
                // Check if we can select more (max 5 per problem)
                if (userSelections.massnahmen[problemId].length < 5) {
                    selectedCard.classList.add('selected');
                    // Add to selections
                    userSelections.massnahmen[problemId].push(optionId);
                } else {
                    alert('Sie können maximal 5 Maßnahmen pro Problem auswählen.');
                    return;
                }
            }
            
            // Enable next button if all problems have 5 measures selected
            let allProblemsHaveMeasures = true;
            selectedProblems.forEach(problemId => {
                if (!userSelections.massnahmen[problemId] || userSelections.massnahmen[problemId].length !== 5) {
                    allProblemsHaveMeasures = false;
                }
            });
            
            document.getElementById('next-to-evaluation').disabled = !allProblemsHaveMeasures;
        }

        // Navigate to a specific step
        function goToStep(stepNumber) {
            // Update step navigation
            stepElements.forEach(step => {
                step.classList.remove('active');
                if (parseInt(step.dataset.step) === stepNumber) {
                    step.classList.add('active');
                }
                
                // Mark previous steps as completed
                if (parseInt(step.dataset.step) < stepNumber) {
                    step.classList.add('completed');
                } else {
                    step.classList.remove('completed');
                }
            });
            
            // Update step content
            stepContentElements.forEach(content => {
                content.classList.remove('active');
                if (parseInt(content.dataset.step) === stepNumber) {
                    content.classList.add('active');
                }
            });
            
            currentStep = stepNumber;
            
            // Load dynamic content for steps 3 and 4
            if (stepNumber === 3 && selectedProblems.length > 0) {
                loadZieleOptions();
            } else if (stepNumber === 4 && selectedProblems.length > 0) {
                loadMassnahmenOptions();
            }
        }

        // Reset step navigation
        function resetStepNavigation() {
            stepElements.forEach(step => {
                step.classList.remove('active', 'completed');
                if (parseInt(step.dataset.step) === 1) {
                    step.classList.add('active');
                }
            });
            
            stepContentElements.forEach(content => {
                content.classList.remove('active');
                if (parseInt(content.dataset.step) === 1) {
                    content.classList.add('active');
                }
            });
            
            currentStep = 1;
        }

        // Evaluate answers and show results
        function evaluateAnswers() {
            const caseStudy = caseStudies[currentCaseIndex];
            
            // Calculate scores
            let categorizationScore = 0;
            let problemScore = 0;
            const zielScores = {};
            const massnahmeScores = {};
            
            // Check categorization
            caseStudy.dataItems.forEach(item => {
                if (userSelections.categorization[item.correctCategory] && 
                    userSelections.categorization[item.correctCategory].includes(item.id)) {
                    categorizationScore++;
                }
            });
            
            // Check problems
            const correctProblems = caseStudy.problems.options.filter(option => option.correct);
            const selectedCorrectProblems = userSelections.problems.filter(id => {
                return caseStudy.problems.options.find(option => option.id === id && option.correct);
            });
            problemScore = selectedCorrectProblems.length;
            
            // Check ziele for each problem
            selectedProblems.forEach(problemId => {
                const correctZiele = caseStudy.ziele[problemId].options.filter(option => option.correct);
                const selectedCorrectZiele = userSelections.ziele[problemId] ? 
                    userSelections.ziele[problemId].filter(id => {
                        return caseStudy.ziele[problemId].options.find(option => option.id === id && option.correct);
                    }) : [];
                zielScores[problemId] = selectedCorrectZiele.length;
            });
            
            // Check massnahmen for each problem
            selectedProblems.forEach(problemId => {
                const correctMassnahmen = caseStudy.massnahmen[problemId].options.filter(option => option.correct);
                const selectedCorrectMassnahmen = userSelections.massnahmen[problemId] ? 
                    userSelections.massnahmen[problemId].filter(id => {
                        return caseStudy.massnahmen[problemId].options.find(option => option.id === id && option.correct);
                    }) : [];
                massnahmeScores[problemId] = selectedCorrectMassnahmen.length;
            });
            
            // Calculate total score
            const totalPossible = caseStudy.dataItems.length + 2 + (2 * selectedProblems.length) + (5 * selectedProblems.length);
            let totalScore = categorizationScore + problemScore;
            selectedProblems.forEach(problemId => {
                totalScore += zielScores[problemId] + massnahmeScores[problemId];
            });
            const percentage = Math.round((totalScore / totalPossible) * 100);
            
            // Update results UI
            categorizationScoreElement.textContent = `${categorizationScore}/${caseStudy.dataItems.length}`;
            problemScoreElement.textContent = `${problemScore}/2`;
            
            // Update ziele scores
            if (selectedProblems.length > 0) {
                ziel1ScoreElement.textContent = `${zielScores[selectedProblems[0]]}/2`;
                if (selectedProblems.length > 1) {
                    ziel2ScoreElement.textContent = `${zielScores[selectedProblems[1]]}/2`;
                }
            }
            
            // Update massnahmen scores
            if (selectedProblems.length > 0) {
                massnahme1ScoreElement.textContent = `${massnahmeScores[selectedProblems[0]]}/5`;
                if (selectedProblems.length > 1) {
                    massnahme2ScoreElement.textContent = `${massnahmeScores[selectedProblems[1]]}/5`;
                }
            }
            
            resultScoreElement.textContent = `${percentage}%`;
            
            // Set feedback based on score
            if (percentage >= 90) {
                resultFeedbackElement.textContent = "Ausgezeichnet! Sie haben fast alle Antworten korrekt ausgewählt.";
            } else if (percentage >= 70) {
                resultFeedbackElement.textContent = "Gut gemacht! Sie haben die meisten Antworten korrekt ausgewählt.";
            } else if (percentage >= 50) {
                resultFeedbackElement.textContent = "Nicht schlecht! Üben Sie weiter, um Ihre Ergebnisse zu verbessern.";
            } else {
                resultFeedbackElement.textContent = "Üben Sie weiter! Wiederholen Sie die Grundlagen der Pflegeplanung.";
            }
            
            // Show results screen
            document.querySelector('.simulator-container').style.display = 'none';
            resultsScreen.classList.add('active');
            
            // Show confetti if score is good
            if (percentage >= 70) {
                showConfetti();
            }
            
            // Update economy (coins and XP)
            updateEconomy(percentage);
            
            // Mark the evaluation step as completed
            document.querySelector('.step[data-step="5"]').classList.add('completed');
        }

        // Show confetti animation
        function showConfetti() {
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 }
            });
            
            // Additional bursts for celebration
            setTimeout(() => confetti({
                particleCount: 100,
                angle: 60,
                spread: 70,
                origin: { x: 0, y: 0.6 }
            }), 250);
            
            setTimeout(() => confetti({
                particleCount: 100,
                angle: 120,
                spread: 70,
                origin: { x: 1, y: 0.6 }
            }), 500);
        }

        // Update economy (coins and XP)
        function updateEconomy(score) {
            // Calculate rewards based on score
            const coinsEarned = Math.floor(score / 10) * 5; // 5 coins per 10% score
            const xpEarned = Math.floor(score / 5) * 2; // 2 XP per 5% score
            
            // Get current values
            let coins = parseInt(document.getElementById('coins').textContent);
            let xp = parseInt(document.getElementById('xp').textContent);
            let level = parseInt(document.getElementById('level').textContent);
            
            // Update values
            coins += coinsEarned;
            xp += xpEarned;
            
            // Check for level up (every 100 XP)
            const newLevel = Math.floor(xp / 100) + 1;
            if (newLevel > level) {
                level = newLevel;
                // Level up celebration
                setTimeout(() => {
                    alert(`Glückwunsch! Sie haben Level ${level} erreicht!`);
                }, 1000);
            }
            
            // Update UI
            document.getElementById('coins').textContent = coins;
            document.getElementById('xp').textContent = xp;
            document.getElementById('level').textContent = level;
            document.getElementById('mobile-coins').textContent = coins;
            document.getElementById('mobile-xp').textContent = xp;
            document.getElementById('mobile-level').textContent = level;
            
            // Save to cookies
            setCookie('pflegeplanung-coins', coins, 30);
            setCookie('pflegeplanung-xp', xp, 30);
            setCookie('pflegeplanung-level', level, 30);
        }

        // Cookie functions
        function setCookie(name, value, days) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        // Load economy from cookies
        function loadEconomy() {
            const coins = getCookie('pflegeplanung-coins') || 150;
            const xp = getCookie('pflegeplanung-xp') || 75;
            const level = getCookie('pflegeplanung-level') || 2;
            
            document.getElementById('coins').textContent = coins;
            document.getElementById('xp').textContent = xp;
            document.getElementById('level').textContent = level;
            document.getElementById('mobile-coins').textContent = coins;
            document.getElementById('mobile-xp').textContent = xp;
            document.getElementById('mobile-level').textContent = level;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Mobile menu toggle
            hamburger.addEventListener('click', () => {
                navMenu.classList.toggle('active');
                hamburger.classList.toggle('active');
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (navMenu.classList.contains('active') && 
                    !navMenu.contains(e.target) && 
                    !hamburger.contains(e.target)) {
                    navMenu.classList.remove('active');
                    hamburger.classList.remove('active');
                }
            });
            
            // Navigation buttons
            document.getElementById('next-to-probleme').addEventListener('click', () => goToStep(2));
            document.getElementById('back-to-categorization').addEventListener('click', () => goToStep(1));
            document.getElementById('next-to-ziele').addEventListener('click', () => goToStep(3));
            document.getElementById('back-to-probleme').addEventListener('click', () => goToStep(2));
            document.getElementById('next-to-massnahmen').addEventListener('click', () => goToStep(4));
            document.getElementById('back-to-ziele').addEventListener('click', () => goToStep(3));
            document.getElementById('next-to-evaluation').addEventListener('click', () => goToStep(5));
            document.getElementById('back-to-massnahmen').addEventListener('click', () => goToStep(4));
            document.getElementById('evaluate-answers').addEventListener('click', evaluateAnswers);
            
            // Results screen buttons
            document.getElementById('review-answers').addEventListener('click', () => {
                resultsScreen.classList.remove('active');
                document.querySelector('.simulator-container').style.display = 'block';
                goToStep(1);
            });
            
            document.getElementById('next-case').addEventListener('click', () => {
                // For now, just reload the same case
                // In a real implementation, you would load the next case
                loadCaseStudy(currentCaseIndex);
            });
            
            document.getElementById('back-to-cases').addEventListener('click', () => {
                // In a real implementation, this would go back to the case selection screen
                alert("In einer vollständigen Implementierung würden Sie hier zur Fallauswahl zurückkehren.");
            });
        }

        // Initialize the simulator when page loads
        document.addEventListener('DOMContentLoaded', initSimulator);
    </script>
</body>
</html>
